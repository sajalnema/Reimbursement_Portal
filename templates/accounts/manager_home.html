{% extends 'base.html' %}

{% block title %}Manager Dashboard{% endblock %}

{% block content %}
<h2>Welcome, {{ user.username }}!</h2>
<p>You are logged in as a manager.</p>

<div class="card">
    <h3>Employees Managed by You</h3>
    {% if managed_employees %}
        <ul>
        {% for employee in managed_employees %}
            <li>{{ employee.username }} - {{ employee.first_name }} {{ employee.last_name }}</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>You are not managing any employees currently.</p>
    {% endif %}
</div>

<div class="card">
    <h3>Track Reimbursements</h3>
    {% if employee_reimbursements %}
        <h4>Your Employees' Reimbursements</h4>
        <ul>
        {% for reimbursement in employee_reimbursements %}
            <li>
                <strong>{{ reimbursement.category }}:</strong> 
                {{ reimbursement.amount }} - 
                {{ reimbursement.status }} -
                <a href="{% url 'reimbursements:detail' reimbursement.pk %}">View Details</a> -
                {% if reimbursement.status == 'pending' %}
                    <form method="post" action="{% url 'reimbursements:approve' reimbursement.pk %}" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="approve">
                        <textarea name="manager_comments" placeholder="Add comments"></textarea>
                        <button type="submit">Approve</button>
                    </form>
                    <form method="post" action="{% url 'reimbursements:decline' reimbursement.pk %}" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="decline">
                        
                        <button type="submit">Decline</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No reimbursement requests from your employees.</p>
    {% endif %}
</div>

<div class="card">
    <h3>Your Reimbursements</h3>
    {% if manager_reimbursements %}
        <ul>
        {% for reimbursement in manager_reimbursements %}
            <li>
                <strong>{{ reimbursement.category }}:</strong> 
                {{ reimbursement.amount }} - 
                {{ reimbursement.status }} -
                <a href="{% url 'reimbursements:detail' reimbursement.pk %}">View Details</a>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>You have not submitted any reimbursement requests yet.</p>
    {% endif %}
</div>

<div class="card">
    <h3>Submit Reimbursement Request</h3>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit</button>
    </form>
</div>

{% endblock %}
